---
import {
  storyblokEditable,
  type SbBlokData,
  renderRichText,
  type StoryblokRichTextNode,
} from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import type { HeroImage } from "@/.storyblok/types/285719928053161/storyblok-components";
import { Image } from "astro:assets";
import { generateResponsiveImageData } from "@/src/utils/optimizeImage";
export interface Props {
  blok: HeroImage;
}

const { blok } = Astro.props;
const { title, description, image, links = [] } = blok;

const imageData = generateResponsiveImageData(image?.filename || "", {
  breakpoints: [240, 320, 400, 560, 800, 1024, 1280],
  aspectRatio: 3 / 2,
  sizes:
    "(max-width: 640px) 100vw, (max-width: 1024px) 50vw, (max-width: 1280px) 33vw, 400px",
  focus: image?.focus || undefined, // Focal point from Storyblok
});
---

<section
  class="bg-base-100 py-16 sm:py-24"
  {...storyblokEditable(blok as SbBlokData)}
>
  <div class="container mx-auto max-w-5xl px-4">
    <div class="hero">
      <div class="hero-content flex-col gap-6 p-0 lg:flex-row-reverse lg:gap-8">
        {
          image?.filename && (
            <Image
              src={imageData.src}
              fetchpriority="high"
              alt={image.alt || title || "Hero image"}
              class="w-full max-w-xs rounded-lg shadow-2xl lg:max-w-sm"
              inferSize
              loading="eager"
              decoding="sync"
            />
          )
        }
        <div class="w-full">
          {
            title && (
              <h1 class="mb-4 text-2xl font-bold sm:text-4xl lg:mb-6 lg:text-5xl">
                {title}
              </h1>
            )
          }
          {
            description && (
              <div class="text-base-content/80 prose prose-sm sm:prose-base lg:prose-lg mb-6 max-w-none leading-relaxed lg:mb-8">
                <Fragment
                  set:html={renderRichText(
                    description as StoryblokRichTextNode,
                  )}
                />
              </div>
            )
          }
          {
            links.length > 0 && (
              <div class="flex flex-wrap justify-center gap-3 lg:justify-start lg:gap-4">
                {links.map((linkBlok) => (
                  <StoryblokComponent blok={linkBlok as SbBlokData} />
                ))}
              </div>
            )
          }
        </div>
      </div>
    </div>
  </div>
</section>
