---
import { storyblokEditable, type SbBlokData } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import { useStoryblokApi } from "@storyblok/astro";

const storyblokApi = useStoryblokApi();

const { blok } = Astro.props;

const [socialMediaData, headerData] = await Promise.all([
  storyblokApi.get("cdn/stories/global/social-media", {
    version: import.meta.env.DEV ? "draft" : "published",
  }),
  storyblokApi.get("cdn/stories/global/header", {
    version: import.meta.env.DEV ? "draft" : "published",
  }),
]);

const socialMedia = socialMediaData.data.story.content;
const socialMediaLinks = socialMedia.body[0].links;

const header = headerData.data.story.content;
// Combine navLinks and ctaButton into a single array
const sitemapLinks =
  header.body[0].navLinks.concat(header.body[0].ctaButton) || [];
---

<footer
  {...storyblokEditable(blok as SbBlokData)}
  class="bg-base-200 text-base-content p-10"
>
  <div class="footer sm:footer-horizontal mx-auto max-w-3xl">
    <nav>
      <h2 class="footer-title">Sitemap</h2>
      {
        sitemapLinks.map((link: any) => (
          <a
            href={
              link.url.linktype === "story"
                ? link.url.cached_url === "home"
                  ? "/"
                  : `/${link.url.cached_url}`
                : link.url.url
            }
            class="link link-hover lg:text-base"
          >
            {link.text}
          </a>
        ))
      }
    </nav>
    <nav>
      <h2 class="footer-title">Legal</h2>
      {blok.legalLinks?.map((link: any) => <StoryblokComponent blok={link} />)}
    </nav>
    <nav>
      <h2 class="footer-title">Social</h2>
      {
        socialMediaLinks?.map((link: any) => (
          <a
            href={
              link.url.linktype === "email"
                ? `mailto:${link.url.url}`
                : link.url.url
            }
            target={link.url.linktype === "email" ? "_self" : "_blank"}
            rel="noopener noreferrer"
            class="link link-hover lg:text-base"
          >
            {link.text}
          </a>
        ))
      }
    </nav>
  </div>
</footer>
