---
import { storyblokEditable, type SbBlokData } from "@storyblok/astro";
import StoryblokComponent from "@storyblok/astro/StoryblokComponent.astro";
import { useStoryblokApi } from "@storyblok/astro";

const storyblokApi = useStoryblokApi();

const { blok } = Astro.props;

// Get global social media data
const { data: socialMediaData } = await storyblokApi.get(
  "cdn/stories/global/social-media",
  {
    version: import.meta.env.DEV ? "draft" : "published",
  },
);

const socialMedia = socialMediaData.story.content;
const socialMediaLinks = socialMedia.body[0].links;
---

<footer
  {...storyblokEditable(blok as SbBlokData)}
  class="footer bg-base-200 text-base-content py-8 md:py-10"
>
  <div class="container mx-auto px-4">
    <!-- Mobile: Centered Stack -->
    <div class="flex flex-col lg:hidden gap-6 items-center text-center">
      <p class="text-sm">
        {blok.copyright}
      </p>

      <nav class="flex flex-wrap gap-4 justify-center">
        {
          blok.legalLinks?.map((link: any) => (
            <StoryblokComponent blok={link} />
          ))
        }
      </nav>

      <nav class="flex flex-wrap gap-4 justify-center">
        {
          socialMediaLinks?.map((link: any) => (
            <a
              href={
                link.url.linktype === "email"
                  ? `mailto:${link.url.url}`
                  : link.url.url
              }
              target={link.url.linktype === "email" ? "_self" : "_blank"}
              rel="noopener noreferrer"
              class="link link-hover text-sm font-semibold uppercase"
            >
              {link.text}
            </a>
          ))
        }
      </nav>
    </div>

    <!-- Desktop: Horizontal Distribution -->
    <div class="hidden lg:flex lg:justify-between lg:items-center">
      <div class="flex-shrink-0">
        <p class="text-base">
          {blok.copyright}
        </p>
      </div>

      <nav class="flex gap-6">
        {
          blok.legalLinks?.map((link: any) => (
            <StoryblokComponent blok={link} />
          ))
        }
      </nav>

      <nav class="flex gap-6">
        {
          socialMediaLinks?.map((link: any) => (
            <a
              href={
                link.url.linktype === "email"
                  ? `mailto:${link.url.url}`
                  : link.url.url
              }
              target={link.url.linktype === "email" ? "_self" : "_blank"}
              rel="noopener noreferrer"
              class="link link-hover text-base font-semibold uppercase"
            >
              {link.text}
            </a>
          ))
        }
      </nav>
    </div>
  </div>
</footer>
